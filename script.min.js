function afficher_bulle(id){document.getElementById(id).style.visibility="visible"}function desafficher_bulle(id){document.getElementById(id).style.visibility="hidden"}function replaceAll(str,findArray,replaceArray){let result=str;for(let i=0;i<findArray.length;i++){const find=findArray[i];const replace=replaceArray[i];result=result.split(find).join(replace)}return result}function fctLinkify(text){const urlRegex=/(https?:\/\/[^\s]+)/g;return text.replace(urlRegex,(function(url){return`<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`}))}function fctNL2BR(text){text=text.replace(/\r?\r/g,"<br><br>");return fctLinkify(text)}function wordwrap(str,width,brk="\n",cut=false){if(!str)return"";str=fctNL2BR(str);let result="";let line="";const words=str.split(/(\s+|-)/);for(let word of words){if((line+word).length>width){if(line){result+=line+brk}line=word.trim()}else{line+=word}}return result+line}function fctAhnenCell(ahnen){ahnenCell="";if(ahnen!==0){if(ahnen<512)return ahnen;else{ahnen=BigInt(ahnen);return"Gen"+ahnen.toString(2).length}}}function getSexColor(Sex){if(Sex==="F")return"#AC0253";else if(Sex==="M")return"#000080";else return"#606060"}function convertDaysToYearsMonths(days){const daysInYear=365.25;const daysInMonth=30.4375;let years=Math.floor(days/daysInYear);let remainingDays=days%daysInYear;let months=Math.floor(remainingDays/daysInMonth);return`${years} ${Annee} ${months} m`}function displayAge(BIRTdate,DEATdate,flagShortFormat=false,flagAgeDifference=false){const todayYear=today.year;const todayMonth=today.month;const todayDay=today.mday;let PREFIX="",ABT="",YEARn="",YEAR="",AND="",MONTHn="",MONTH="";let flagAlive=false;BIRTdate=BIRTdate.substring(0,8);DEATdate=DEATdate.substring(0,8);if(!BIRTdate||BIRTdate.startsWith("!")||DEATdate.startsWith("!"))return"";if(BIRTdate&&!DEATdate){if(BIRTdate.substring(0,4)>todayYear-99){DEATdate=String(todayYear).padStart(4,"0")+String(todayMonth).padStart(2,"0")+String(todayDay).padStart(2,"0");flagAlive=true}else{return""}}const d1=new Date(parseInt(BIRTdate.substring(0,4),10),parseInt(BIRTdate.substring(4,6),10),parseInt(BIRTdate.substring(6,8),10));const d2=new Date(parseInt(DEATdate.substring(0,4),10),parseInt(DEATdate.substring(4,6),10),parseInt(DEATdate.substring(6,8),10));const diffYears=d2.getFullYear()-d1.getFullYear();const diffMonths=d2.getMonth()-d1.getMonth()+(d2.getDate()<d1.getDate()?-1:0);YEARn=diffYears;MONTHn=(diffMonths+12)%12;if(BIRTdate.substring(4,6)!=="00"&&BIRTdate.substring(6,8)!=="00"&&DEATdate.substring(4,6)!=="00"&&DEATdate.substring(6,8)!=="00"){YEAR=gotLang.Ans;MONTH=gotLang.Mois;if(flagShortFormat){YEAR=gotLang.Annee;if(flagAgeDifference&&YEARn>0)YEARn="+"+YEARn;MONTHn="";MONTH=""}else{AND=gotTag.AND;PREFIX=flagAlive?gotLang.Age:gotLang.AgeDe}}else{YEAR=gotLang.Ans;MONTHn="";if(flagShortFormat){YEAR=gotLang.Annee;if(flagAgeDifference&&YEARn>0)YEARn="+"+YEARn;AND="~"}else{ABT=gotLang.Envir;PREFIX=flagAlive?gotLang.Age:gotLang.AgeDe}}return`${PREFIX} ${ABT} ${YEARn} ${YEAR} ${AND} ${MONTHn} ${MONTH}`.trim()}function getDatePrefix(YYYYMMDD,NoSeq,flagTag,flagHide75,prefixObj,yearOnly){let DAY="",MONTH="",YEAR="";if(YYYYMMDD!==""){if(YYYYMMDD.substring(6,8)!=="00"){if(YYYYMMDD.charAt(6)==="0")DAY=YYYYMMDD.charAt(7);else DAY=YYYYMMDD.substring(6,8);if(NoSeq==="1")prefixObj.PREFIX+=" "+gotLang.Le;else prefixObj.INTER+=" "+gotLang.Le}else{DAY="";if(flagTag==="0"){if(NoSeq==="1"){prefixObj.PREFIX+=" "+gotLang.En}else{prefixObj.INTER+=" "+gotLang.En}}}MONTH=gotTag[YYYYMMDD.substring(4,6)];if(flagHide75===1)YEAR="X";else YEAR=parseInt(YYYYMMDD.substring(0,4))}if(yearOnly){prefixObj.PREFIX="";prefixObj.INTER="";return`${YEAR}`.trim()}else return`${DAY} ${MONTH} ${YEAR}`.trim()}function displayDate(date,yearOnly=false,withOutPrefix=false){let PREFIX="",INTER="",DATE1="",DATE2="";let flagTag=false;if(date==="")return"";if(date.charAt(0)==="!")return date;let part=date.split(" ");for(let i=0;i<=5;i++){if(!part[i])part[i]=""}let flagHide751=0,flagHide752=0;if(hide75==1){if(parseInt(part[0].substring(0,4))>=today.year-75)flagHide751=1;if(parseInt(part[1].substring(0,4))>=today.year-75)flagHide752=1}if(!yearOnly&&!withOutPrefix){if(part[2])PREFIX=gotTag[part[2]]||"";if(part[3]==="ABT")PREFIX+=" "+(gotTag[part[3]]||"")}if(part[2])flagTag=true;const prefixObj={PREFIX:"",INTER:""};DATE1=getDatePrefix(part[0],"1",flagTag?"1":"0",flagHide751,prefixObj,yearOnly);if(!yearOnly){if(["AND","TO"].includes(part[3]))INTER=gotTag[part[3]]||"";if(["AND","TO"].includes(part[4]))INTER=gotTag[part[4]]||"";if(part[5]==="ABT")INTER+=" "+(gotTag[part[5]]||"")}if(["AND","TO"].includes(part[3])||["AND","TO"].includes(part[4]))flagTag=true;if(part[1]!=="00000000"){DATE2=getDatePrefix(part[1],"2",flagTag?"1":"0",flagHide752,prefixObj,yearOnly)}if(!yearOnly){PREFIX=(prefixObj.PREFIX+" "+PREFIX).trim();INTER=(prefixObj.INTER+" "+INTER).trim();if(PREFIX==="de le")PREFIX="du";if(PREFIX==="à le")PREFIX="au";if(INTER==="de le")INTER="du";if(INTER==="à le")INTER="au"}return`${PREFIX} ${DATE1} ${INTER} ${DATE2}`.trim()}function onLibelleClick(libelleElement,tag,tagValue){window.location.href=PagePhp+"?"+HrefBase+"&"+tag+"="+tagValue}function DivJsonGotTag(divName,dataJson,p1,withNb="FALSE"){const container=document.getElementById(divName);container.style.border="1px solid black";let output="";gotTag2=gotTag;if((PagePhp==="evenement.php"||PagePhp==="media.php")&&p1==="pag"){gotTag2["%"]=gotLang.Tous}if((PagePhp==="listes.php"||PagePhp==="stat.php"||PagePhp==="arbre_descendant.php")&&p1==="pag"){gotTag2=`{\n      "nom"           : "${gotLang.Noms}",\n      "lieu_evene"    : "${gotLang.Lieux}",\n      "dept_evene"    : "${gotLang.Depar}",\n      "country_evene" : "${gotTag.CTRY}",\n      "region_evene"  : "${gotLang.Regio}",\n      "prenom1"       : "${gotLang.Preno}",\n      "lon"           : "${gotLang.StLon}",\n      "marA"          : "${gotTag.AGE} ${gotTag.MARR}",\n      "marD"          : "${gotLang.Duree} ${gotTag.MARR}",\n      "par"           : "${gotTag.AGE} ${gotLang.StPar}",\n      "fam"           : "${gotLang.StFam}",\n      "jum"           : "${gotLang.Jumea}",\n      "1"             : "1",\n      "2"             : "2",\n      "3"             : "3",\n      "4"             : "4",\n      "5"             : "5",\n      "6"             : "6"\n      }`;gotTag2=JSON.parse(gotTag2)}if(p1==="sex"){gotTag2=`{\n      "_"  : "${gotLang.Tous}",\n      "F"  : "${gotLang.Femme}",\n      "M"  : "${gotLang.Homme}"\n      }`;gotTag2=JSON.parse(gotTag2)}if(p1==="sosa"){gotTag2=`{\n      "0": "${gotLang.Tous}",\n      "1": "${gotLang.Sosa}"\n      }`;gotTag2=JSON.parse(gotTag2)}dataJson.forEach(((item,index)=>{TagLib=gotTag2[item.Code];if(item.Code===getPag&&p1==="pag"||item.Code===Sex&&p1==="sex"||item.Code===Sosa){style="menu_encours"}else{style="menu_td"}output+=` <span class=${style} style="line-height:2.2;" onclick="onLibelleClick(this, '${p1}', '${item.Code}')">${TagLib}</span>`;if(withNb!=="FALSE"){output+=`<span style="font-size:0.8em;">${item.Nb}</span>`}}));container.innerHTML=output}function SubMenuSql(fonc,p1="",p2="",p3="",p4="",p5=""){let start=0;let loading=false;function loadData(){if(loading)return;loading=true;const xhr=new XMLHttpRequest;xhr.open("GET",`get_data.php?start=${start}&${HrefBase}&fonc=${fonc}&p1=${p1}&p2=${p2}&p3=${p3}&p4=${p4}&p5=${p5}&sort_column=Nb&sort_order=DESC`,true);xhr.onload=function(){if(this.status===200){const dataJson=JSON.parse(this.responseText);if(dataJson.length>0){DivJsonGotTag("DivSubMenu",dataJson,"pag","TRUE");start+=dataJson.length}loading=false}else console.error(this.responseText)};xhr.send()}loadData()}function SubMenuSex(){dataJson=`[{"Code":"_", "Nb":0},{"Code":"M", "Nb":0},{"Code":"F", "Nb":0}]`;dataJson=JSON.parse(dataJson);DivJsonGotTag("DivSex",dataJson,"sex")}function SubMenuSosa(){dataJson=`[{"Code":"0", "Nb":0},{"Code":"1", "Nb":0}]`;dataJson=JSON.parse(dataJson);DivJsonGotTag("DivSosa",dataJson,"sosa")}function SubMenuJson(dataJson){dataJson=JSON.parse(dataJson);DivJsonGotTag("DivSubMenu",dataJson,"pag")}function DivSearch(){const container=document.getElementById("DivSearch");const inputContainer=document.createElement("div");inputContainer.className="input-container";const rech=document.createElement("input");rech.type="text";rech.id="rech";rech.value=Rech?Rech:"";const clearButton=document.createElement("button");clearButton.className="clear-button";clearButton.innerHTML="&times;";clearButton.addEventListener("click",(function(e){e.preventDefault();rech.value="";rech.focus();clearButton.style.display="none"}));const okButton=document.createElement("button");okButton.id="okButton";okButton.textContent="OK";okButton.type="image";okButton.src="themes/icon-loupe.png";okButton.width=120;inputContainer.appendChild(rech);inputContainer.appendChild(clearButton);container.appendChild(inputContainer);container.appendChild(okButton);function validateInput(){const inputValue=rech.value.trim();const currentUrl=new URL(window.location.href);currentUrl.searchParams.set("rech",inputValue);window.location.href=currentUrl.toString()}okButton.addEventListener("click",validateInput);rech.addEventListener("keydown",(function(event){if(event.key==="Enter"){validateInput()}}));rech.addEventListener("input",(function(){if(rech.value.length>0){clearButton.style.display="inline"}else{clearButton.style.display="none"}}));document.getElementById("rech").focus()}function DivIcons(divId,urlIcon,href){const maDiv=document.getElementById(divId);const monImage=document.createElement("img");monImage.src=urlIcon;monImage.width=35;monImage.addEventListener("click",(function(event){window.open(href,"_blank")}));maDiv.textContent="";maDiv.appendChild(monImage)}function displayDiv(divName,text){var maDiv=document.getElementById(divName);maDiv.innerHTML=text}function initCard(){displayDiv("DivCardPrint","");displayDiv("DivCardName","");displayDiv("DivCard","");displayDiv("headerMap","");displayDiv("map","");const labels=["Parents","Spouse","Children","Siblings","PetEf","Oncle","Neveu","Germa","OncGr","CouGr","CouIs"];labels.forEach((label=>{displayDiv("Div"+label,"");displayDiv("Tab"+label,"")}));for(let i=0;i<=25;i++){displayDiv("DivSource"+i,"")}}function displayWaitMessage(){const myDiv=document.getElementById("waitMessage");myDiv.innerHTML="Traitement en cours... Veuillez patienter.";document.getElementById("waitMessage").style.display="block"}function fctToggleEdit(id){document.getElementById("edit_"+id).style.display="block";document.getElementById("row_"+id).style.display="none"}function fctToggleAdd(){document.getElementById("add_form").style.display="block"}function fctConfirmDelete(id){if(confirm("Êtes-vous sûr de vouloir supprimer cet enregistrement ?"))window.location.href="?pag2=geo&delete="+encodeURIComponent(id)}function fctUpdateRow(id){var form=document.getElementById("edit_form_"+id);var data=new FormData(form);data.append("update","true");fetch("",{method:"POST",body:data}).then((response=>response.text())).then((()=>location.reload()))}function fctCancelEdit(id){document.getElementById("edit_"+id).style.display="none";document.getElementById("row_"+id).style.display="table-row"}function fctCancelAdd(){document.getElementById("add_form").style.display="none"}function fctFormEditBase(col5,sql_pref){document.getElementById("FormEditBase").style.display="block";document.getElementById("SubmitButton").onclick=function(event){event.preventDefault();const password=document.getElementById("textPassword").value;const hide75=document.querySelector('input[name="hide75"]:checked')?.value;if(hide75===undefined){alert("Please enter a Hide75 value.");return}const params=new URLSearchParams({password:password,hide75:hide75,base:col5,sql_pref:sql_pref});fetch("fetchUpdateBase.php?"+params.toString(),{method:"GET"}).then((response=>response.text())).then((data=>{document.getElementById("FormEditBase").style.display="none";window.location.href=PagePhp+"?"+HrefBase})).catch((error=>{console.error("Erreur :",error);alert("Error while updating.")}))}}function fctFormYesNo(scriptPHP,fid,ibase,sql_pref){const modal=document.getElementById("modal");const openModalBtn=document.getElementById("openModalBtn");const yesBtn=document.getElementById("yesBtn");const noBtn=document.getElementById("noBtn");modal.style.display="block";document.body.classList.add("modal-open");yesBtn.focus();yesBtn.addEventListener("click",(function(){displayWaitMessage();const params=new URLSearchParams({id:fid,ibase:ibase,sql_pref:sql_pref});fetch(scriptPHP+"?"+params.toString(),{method:"GET"}).then((response=>{if(!response.ok){throw new Error("Erreur serveur : "+response.status)}return response.text()})).then((data=>{document.getElementById("waitMessage").textContent="Terminé"}));modal.style.display="none";document.body.classList.remove("modal-open");window.location.href=PagePhp+"?"+HrefBase}));noBtn.addEventListener("click",(function(){modal.style.display="none";document.body.classList.remove("modal-open");openModalBtn.focus()}));document.addEventListener("keydown",(function(event){if(event.key==="Escape"&&modal.style.display==="block"){modal.style.display="none";document.body.classList.remove("modal-open");openModalBtn.focus()}if(modal.style.display==="block"){if(event.key==="ArrowRight"){if(document.activeElement===yesBtn){noBtn.focus()}}else if(event.key==="ArrowLeft"){if(document.activeElement===noBtn){yesBtn.focus()}}}}))}function displayFiche(fid=1215,sex){initCard();console.log("fid:",fid);var map=document.getElementById("map");map.style.height=0;DivIcons("DivCardPrint","themes/icon-print.png","fiche_pdf.php"+"?"+HrefBase+"&fid="+fid);if(ServeurLocal==1||ServeurLocal==0&&ibase!=="royal"&&ibase!=="royal_small"){openModalBtn.style.display="block";openModalBtn.addEventListener("click",(function(){fctFormYesNo("fetchUpdateDecujus.php",fid,ibase,sql_pref)}))}displayCardGrid("recup_individu","1","ASC",fid,"","");displayCardGrid("recup_evenements","1","ASC",fid,"","");enteteCol=`["","","","","","${gotLang.Noms}","${gotLang.Years}","${gotLang.Lieux}"]`;pagination("TabParents",enteteCol,"recup_parent","sexe","DESC",fid);displayDiv("DivParents","<br>"+gotLang.StPar);displayDiv("DivSpouse","<br>"+gotLang.NomCo);pagination("TabSpouse",enteteCol,"recup_conjoints","date_naiss","ASC",fid,sex);displayDiv("DivChildren","<br>"+gotLang.Enfan);pagination("TabChildren",enteteCol,"recup_enfants","date_naiss","ASC",fid,sex);displayDiv("DivSiblings","<br>"+gotLang.Frere);pagination("TabSiblings",enteteCol,"recup_fratrie","date_naiss","ASC",fid,sex);displayDiv("DivPetEf","<br>"+gotLang.PetEf);pagination("TabPetEf",enteteCol,"recup_cousin","1","ASC",fid,0,2);displayDiv("DivOncle","<br>"+gotLang.Oncle);pagination("TabOncle",enteteCol,"recup_cousin","1","ASC",fid,2,1);displayDiv("DivNeveu","<br>"+gotLang.Neveu);pagination("TabNeveu",enteteCol,"recup_cousin","1","ASC",fid,1,2);displayDiv("DivGerma","<br>"+gotLang.Germa);pagination("TabGerma",enteteCol,"recup_cousin","1","ASC",fid,2,2);displayDiv("DivOncGr","<br>"+gotLang.OncGr);pagination("TabOncGr",enteteCol,"recup_cousin","1","ASC",fid,3,1);displayDiv("DivCouGr","<br>"+gotLang.CouGr);pagination("TabCouGr",enteteCol,"recup_cousin","1","ASC",fid,3,2);displayDiv("DivCouIs","<br>"+gotLang.CouIs);pagination("TabCouIs",enteteCol,"recup_cousin","1","ASC",fid,3,3)}function displayCardGrid(fonc,sortColumn="1",sortOrder="ASC",p1="",p2="",p3="",p4="",p5=""){let start=0;var xhr=new XMLHttpRequest;xhr.open("GET",`get_data.php?start=${start}&${HrefBase}&fonc=${fonc}&p1=${p1}&p2=${p2}&p3=${p3}&p4=${p4}&p5=${p5}&sort_column=${sortColumn}&sort_order=${sortOrder}`,true);xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var data=JSON.parse(xhr.responseText);data.forEach((function(row,index){let Span="";if(fonc==="recup_individu"){if(row.sosa==0){sosaLine=""}else{binarySosa=Number(row.sosa).toString(2);sosaGeneration=binarySosa.toString().length;sosaLine='<br><span style="font-size:1.6em; font-weight:bold; color:red;">'+gotLang.Sosa+" n° "+row.sosa+"</span>"+'<span style="font-size:1.4em; font-weight:bold; color:'+getSexColor("M")+';"> - '+gotLang.Gener+" "+sosaGeneration+"</span>"}if(row.profession!==""){FirstProfession="<br>"}else{FirstProfession=""}if(row.date_naiss!==""){FirstNaiss="<br>"+gotLang.Ne+" "}else{FirstNaiss=""}if(row.lieu_naiss!==""){MiddleNaiss=" "+gotLang.Situa+" "}else{MiddleNaiss=""}if(row.date_deces!==""){FirstDeath="<br>† ";EndDeath="<br>"+displayAge(row.date_naiss,row.date_deces)}else{FirstDeath="";EndDeath=""}if(row.lieu_deces!==""){MiddleDeath=" "+gotLang.Situa+" "}else{MiddleDeath=""}Span='<span class=ligne_tr2 style="text-align:center; font-size:1.6em; font-weight:bold; display:flex; flex-direction:column;">'+row.nom+" "+row.prenom2;if(row.name2!="")Span+="<br>"+row.name2;Span+="</span>";displayDiv("DivCardName",Span);display_fly_menu(p1);Span=displayCardGridSpanThumb(row.url);Span+=sosaLine+"<span>"+FirstProfession+row.profession+"</span>"+"<span><b>"+FirstNaiss+displayDate(row.date_naiss)+"</b> "+MiddleNaiss+row.lieu_naiss+"</span>"+"<span><b>"+FirstDeath+displayDate(row.date_deces)+"</b> "+MiddleDeath+row.lieu_deces+EndDeath+"</span>";if(row.note_indi!==""){Span+='<span style="text-align:left; font-size:1.3em; font-weight:bold; display:flex; flex-direction:column;"><br><br><b>'+gotLang.NotIn+"</b></span>"+'<span style="text-align:left; display:flex; flex-direction:column;">'+fctNL2BR(row.note_indi)+"</span>"}displayDiv("DivCard",Span)}if(fonc==="recup_evenements"){Span="<span><b>"+gotTag[row.type_evene]+"</b> ";{if(displayDate(row.date_evene))Span+=displayDate(row.date_evene);if(row.lieu_evene)Span+=" "+gotLang.Situa+" "+row.lieu_evene+"</span>";Span+="<br><table><tr><td>&emsp;&emsp;&emsp;</td><td><span>"+fctNL2BR(row.note_source)+"</span></td></tr>";Span+=displayCardGridSpanThumb(row.attr_sourc);Span+="</table>";displayDiv("DivSource"+index+"Line","<br>");displayDiv("DivSource"+index,Span)}}}))}else{}};xhr.send()}function displayCardGridSpanThumb(Url){let Span="";if(Url!==""&&Url!==null){Span="<table><tr>";TabUrl=Url.split("/");TabUrl.forEach((rowUrl=>{PartRow=rowUrl.split("|");if(PartRow[2]>0){Span+="</tr></table><table><tr><td>";Span+=`<a href=# onclick="displayFiche(${PartRow[2]});" style="font-weight:bold; color:"M";">${PartRow[0]}</a>`;Span+="</td></tr></table><tr>"}if(PartRow[0].includes("jpg")||PartRow[0].includes("JPG")||PartRow[0].includes("png")||PartRow[0].includes("PNG")){images.push(PartRow[0]);let indiceAjoute=images.length-1;UrlImg=encodeURIComponent(PartRow[0]);Span+="<br><td></td><td>";Span+=`<img height=132 src=picture/${ibase}/${UrlImg} onclick="openPopup('${indiceAjoute}')" onerror="this.src='themes/not_found.png'; this.alt='Image not found';">`+"<br>"+PartRow[1]+"</td>"}}));Span+="</tr></table>"}return Span}function addHeader(IdDiv,Text){const tableHeader=document.getElementById(IdDiv);const th=document.createElement("th");th.innerHTML=Text;if(th){tableHeader.appendChild(th)}}function addTD(IdBody,flagNewTR,Text,Sex=""){const tableBody=document.getElementById(IdBody);let tr;if(flagNewTR){tr=document.createElement("tr");if(ii%2===1){tr.classList.add("ligne_tr2")}tableBody.appendChild(tr)}else{tr=tableBody.lastElementChild}const td=document.createElement("td");td.innerHTML=Text;if(tr){tr.appendChild(td)}}function displayStatAscendancy(id,Nom){displayWaitMessage();fetch(`fetchGetAscendant.php?ibase=${ibase}&id=${id}`).then((response=>response.json())).then((data=>{ii=0;displayDiv("DivCardName","<span class=titre>"+gotLang.Ascen+" "+Nom+"</span>");fctDisplayMap(data);if(ibase!=="royal"){const rootsNobles=findRootsNobles(data);if(rootsNobles.length!==0){const rootsNoblesSansDoublons=rootsNobles.filter(((individu,index,self)=>index===self.findIndex((t=>t.id_indi===individu.id_indi))));displayDiv("DivParents","<br>"+gotLang.Noble);addHeader("TabParents-header",gotLang.Noms);addHeader("TabParents-header",gotLang.Years);addHeader("TabParents-header",gotLang.Lieux);const div=document.getElementById("TabParents");rootsNoblesSansDoublons.forEach((individu=>{sexColor=getSexColor(individu.sexe);href=`<a href="arbre_ascendant.php?${HrefBase}&id=${individu.id_indi}"><div style="font-weight:bold; color:${sexColor};">${individu.nom}</div></a>`;addTD("Parents-body",true,href,individu.sexe);addTD("Parents-body",false,displayDate(individu.date_naiss,true));addTD("Parents-body",false,individu.lieu_naiss);ii++}))}}displayDiv("DivSpouse","<br>"+gotLang.PalNo);const occurrences={};data.generation.forEach((num=>{occurrences[num]=(occurrences[num]||0)+1}));const result=Object.keys(occurrences).map((key=>({gen:parseInt(key)+1,nb:occurrences[key],pourcentage:Math.round(occurrences[key]/2**parseInt(key)*100)+"%"})));let totalIntermediaire=0;const resultAvecTotal=result.map((row=>{totalIntermediaire+=row.nb;return{...row,total_intermediaire:totalIntermediaire}}));let tableHeader=document.getElementById("TabSpouse-header");let tableBody=document.getElementById("Spouse-body");let headers=Object.keys(resultAvecTotal[0]);headers.forEach(((header,headerIndex)=>{const th=document.createElement("th");if(headerIndex===0){th.textContent=gotLang.Gener}if(headerIndex===1){th.textContent=gotLang.Nombr}if(headerIndex===2){th.textContent="%"}if(headerIndex===3){th.textContent=gotLang.Cumul}th.classList.add("ligne_tr2");tableHeader.appendChild(th)}));resultAvecTotal.forEach(((row,rowIndex)=>{const tr=document.createElement("tr");tr.style.textAlign="center";if(rowIndex%2===1){tr.classList.add("ligne_tr2")}Object.keys(row).forEach((key=>{const td=document.createElement("td");td.textContent=row[key];tr.appendChild(td)}));tableBody.appendChild(tr)}));document.getElementById("waitMessage").textContent="Terminé"}))}function display_stat_descendance(id){fetch(`fetchGetDescendant.php?ibase=${ibase}&id=${id}&ADDRC=${ADDRC}`).then((response=>response.json())).then((data=>{const occurrences={};data.generation.forEach((num=>{occurrences[num]=(occurrences[num]||0)+1}));const result=Object.keys(occurrences).map((key=>({gen:parseInt(key)+1,nb:occurrences[key]})));const totalNb=result.reduce(((acc,curr)=>acc+curr.nb),0);displayDiv("DivParents","<br>");displayDiv("DivSpouse",gotLang.PalNo);let tableHeader=document.getElementById("TabSpouse-header");let tableBody=document.getElementById("Spouse-body");let headers=Object.keys(result[0]);headers.forEach(((header,headerIndex)=>{const th=document.createElement("th");if(headerIndex===0){th.textContent=gotLang.Gener}if(headerIndex===1){th.textContent=gotLang.Nombr}th.classList.add("ligne_tr2");tableHeader.appendChild(th)}));result.forEach(((row,rowIndex)=>{const tr=document.createElement("tr");tr.style.textAlign="center";if(rowIndex%2===1){tr.classList.add("ligne_tr2")}Object.keys(row).forEach((key=>{const td=document.createElement("td");td.textContent=row[key];tr.appendChild(td)}));tableBody.appendChild(tr)}));const totalRow=document.createElement("tr");totalRow.style.textAlign="center";const total=document.createElement("td");total.textContent="";totalRow.appendChild(total);const totalNbCell=document.createElement("td");totalNbCell.textContent=totalNb;totalNbCell.style.fontWeight="bold";totalRow.appendChild(totalNbCell);tableBody.appendChild(totalRow);fctDisplayMap(data)}))}function display_fly_menu(id=1215){const DivCard=document.getElementById("DivCardName");const menu=document.getElementById("menu");DivCard.addEventListener("mouseover",(function(){menu.style.display="block";document.getElementById("link1").href=`arbre_mixte.php?${HrefBase}&id=${id}`;document.getElementById("link2").href=`arbre_ascendant.php?${HrefBase}&id=${id}`;document.getElementById("link3").href=`arbre_descendant.php?${HrefBase}&id=${id}`;if(csg==="O"){document.getElementById("link4").href=`arbre_consanguinite.php?${HrefBase}&id=${id}`}}));DivCard.addEventListener("mouseout",(function(event){if(!event.relatedTarget||!menu.contains(event.relatedTarget)){menu.style.display="none"}}));menu.addEventListener("mouseleave",(function(){menu.style.display="none"}))}function fctArrNamesToMaps(data){const reorganizedData=data.reduce(((acc,item)=>{acc.nom.push(item.nom);acc.date_naiss.push(item.date_naiss);acc.lieu_naiss.push(item.lieu_naiss);return acc}),{nom:[],date_naiss:[],lieu_naiss:[]});return reorganizedData}function pagination(tableName,jsonEnteteCol,fonc,sortColumn="1",sortOrder="ASC",p1="",p2="",p3="",p4="",p5="",p6="",p7=""){let start=0;const limit=200;let loading=false;jsonEnteteCol=JSON.parse(jsonEnteteCol);if(fonc==="recup_cousin"){pageGet="fetchGetCousin.php"}else{pageGet="get_data.php"}function loadMoreData(){if(loading)return;loading=true;const xhr=new XMLHttpRequest;xhr.open("GET",`${pageGet}?start=${start}&${HrefBase}&fonc=${fonc}&p1=${p1}&p2=${p2}&p3=${p3}&p4=${p4}&p5=${p5}&p6=${p6}&sort_column=${sortColumn}&sort_order=${sortOrder}`,true);xhr.onload=function(){if(this.status===200){try{const data=JSON.parse(this.responseText);if(data.length>0){renderTable(data,jsonEnteteCol);start+=data.length}}catch(e){console.error("Ajax Request : ",pageGet,start,HrefBase,fonc,p1,p2,p3,p4,p5,p6,sortColumn,sortOrder,"Server response : ",this.responseText,"Error detail : ",e.name,e.message)}loading=false}else{console.error(pageGet,start,HrefBase,fonc,p1,p2,p3,p4,p5,p6,sortColumn,sortOrder);console.error(this.responseText)}};xhr.send()}function sortTable(column){const currentOrder=sortOrder;sortColumn=column;sortOrder=currentOrder==="ASC"?"DESC":"ASC";start=0;document.getElementById(tableName+"-header").innerHTML="";document.getElementById(tableName+"-body").innerHTML="";loadMoreData()}function updateSortIndicators(){const headers=document.querySelectorAll("th");headers.forEach(((header,headerIndex)=>{const existingIndicators=header.querySelectorAll(".sort-indicator");existingIndicators.forEach((indicator=>indicator.remove()));if(header.dataset.column===sortColumn){const indicator=document.createElement("span");indicator.classList.add("sort-indicator");indicator.textContent=sortOrder==="ASC"?"▲":"▼";header.appendChild(indicator)}}))}function renderTable(data,jsonEnteteCol){let tableHeader,tableBody;tableHeader=document.getElementById(tableName+"-header");tableBody=document.getElementById(tableName+"-body");let headers=Object.keys(data[0]);if(tableHeader.children.length===0){const headers=Object.keys(data[0]);headers.forEach(((header,headerIndex)=>{if(headerIndex>=5){const th=document.createElement("th");th.textContent=jsonEnteteCol[headerIndex];th.classList.add("bords_verti","ligne_tr2");th.dataset.column=header;th.dataset.order="ASC";th.addEventListener("click",(()=>sortTable(header)));if(headers[headerIndex]!=="age1"){tableHeader.appendChild(th)}}}))}data.forEach(((row,rowIndex)=>{const tr=document.createElement("tr");if(rowIndex%2===1){tr.classList.add("ligne_tr2")}let IdIndi=Object.values(row)[0];let IdWife=Object.values(row)[1];let Sex=Object.values(row)[2];let Sosa=Object.values(row)[3];let SosaWife=Object.values(row)[4];let Col1=Object.values(row)[5];let Col5=Object.values(row)[9];let age1=Object.values(row)[8];if(Sex===null){Sex=""}SexColor=getSexColor(Sex);if(Sosa==0||Sosa===null){Sosa=""}if(SosaWife==0||SosaWife===null){SosaWife=""}Object.keys(row).forEach(((key,index)=>{let UrlImg="";if(index>=5){const td=document.createElement("td");const columnName=headers[index];td.classList.add("bords_verti");let cellContent=row[key];cellContent=cellContent||"";if(cellContent.substring(0,1)===","){cellContent=cellContent.substring(1)}if(PagePhp==="listes.php"&&columnName==="Col1"){td.innerHTML=`<a href=# style="font-weight:bold;">${cellContent}</a>`;td.addEventListener("click",(event=>{const DivCardName=document.getElementById("DivCardName");if(DivCardName)initCard();enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+gotLang.Lieux+" "+gotTag.BIRT+`"]`;displayDiv("DivTitleMain2",Col1);Col1WithoutParenthesis=Col1.split(" (")[0];Col1WithoutParenthesis=encodeURIComponent(Col1WithoutParenthesis);pagination("TabMain2",enteteCol,"recup_eclair",sortColumn=6,sortOrder="ASC",p1="",p2="",p3=0,p4=Col1WithoutParenthesis);var xhr=new XMLHttpRequest;xhr.open("GET",`get_data.php?start=0&${HrefBase}&fonc=recup_eclair&p1=${p1}&p2=${p2}&p3=${p3}&p4=${Col1WithoutParenthesis}&sort_column=${sortColumn}&sort_order=${sortOrder}`,true);xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var data=JSON.parse(xhr.responseText);data.sort(((a,b)=>a.nom.localeCompare(b.nom)));data=fctArrNamesToMaps(data);fctDisplayMap(data)}};xhr.onerror=function(){console.error("Erreur lors de la requête Ajax ")};xhr.send()}))}else if(columnName==="base"){td.innerHTML=`<a href = arbre_ascendant.php?ibase=${encodeURIComponent(cellContent)}${HrefBase}>${cellContent}</a>`}else if(columnName==="nom"||columnName==="nom_wife"){let Fid="";let AhnenCell="";if(columnName==="nom"){AhnenCell=fctAhnenCell(Sosa);Fid=IdIndi}else{AhnenCell=fctAhnenCell(SosaWife);Fid=IdWife}if(columnName==="nom_wife")SexColor=getSexColor("F");td.innerHTML=`<a href=# style="font-weight:bold; color: ${SexColor};">${cellContent}</a> <span style="font-weight:bold; color: red;">${AhnenCell}</span>`;td.addEventListener("click",(event=>{displayFiche(Fid,Sex)}))}else if(columnName==="type_evene"){td.textContent=gotTag[cellContent]}else if(columnName==="date"||columnName==="date_naiss"){td.textContent=displayDate(cellContent,true)}else if(columnName==="url"){images.push(cellContent);let indiceAjoute=images.length-1;UrlImg=encodeURIComponent(cellContent);td.innerHTML="<span>"+`<img height=54 src=picture/${ibase}/${UrlImg} onclick="openPopup('${indiceAjoute}')" onerror="this.src='themes/not_found.png'; this.alt='Image not found';">`+cellContent+"</span>"}else if(columnName==="calcul"&&p5!=="nb"){td.textContent=convertDaysToYearsMonths(cellContent)}else if(columnName==="age2"){td.innerHTML=displayAge(cellContent,age1,true,true)}else if(columnName==="upload"){if(Col1){filename=Col1.split(".");td.innerHTML="<a href=admin.php?ibase="+encodeURIComponent(filename[0])+"&ext="+filename[1]+HrefBase+">&nbsp;<img height=20 src=themes/fleche_droite.png >&nbsp;<span>"+gotLang.IBCha+"</span></a>"}}else if(columnName==="editBase"){td.innerHTML="<span>"+`<img height=15 src=themes/icon-edit.png \n                           onclick="fctFormEditBase('${Col5}', '${sql_pref}')" \n                           onerror="this.src='themes/not_found.png'; this.alt='Image not found';">`+"</span>"}else if(columnName==="deleteBase"){if(Col5){td.innerHTML="<span>"+`<img height=15 src="themes/icon-delete.png" \n                             onerror="this.src='themes/not_found.png'; this.alt='Image not found';" \n                             onclick="fctFormYesNo('fetchDeleteBase.php', 0, '${Col5}', '${sql_pref}');">`+"</span>"}}else{td.innerHTML=wordwrap(cellContent,70,"<br>")}if(columnName.substring(0,2)==="nb"){td.style.textAlign="right"}if(columnName!=="age1"){tr.appendChild(td)}}}));tableBody.appendChild(tr)}));updateSortIndicators()}function initPagination(){const table=document.getElementById(tableName);const thead=table.querySelector("thead");const tbody=table.querySelector("tbody");table.innerHTML=`<thead id="${tableName}-header"></thead><tbody id="${tableName}-body"></tbody>`;if(fonc==="get_events"||fonc==="recup_media"||fonc==="recup_eclair"||fonc.substring(0,10)==="recup_base"){window.addEventListener("scroll",(()=>{if(window.innerHeight+window.scrollY>=document.body.offsetHeight-100){loadMoreData()}}))}loadMoreData()}initPagination()}async function fctGeocodeNominatim(adresse){return fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(adresse)}`).then((response=>response.json())).then((data=>{if(data&&data.length>0){const lat=parseFloat(data[0].lat);const lon=parseFloat(data[0].lon);return{adresse:adresse,lat:lat,lon:lon}}else{return null}})).catch((err=>{console.error("Nominatim Error:",err);return null}))}function sleep(ms){return new Promise((resolve=>setTimeout(resolve,ms)))}async function fctDisplayMap(jsonData,largeur="100%",hauteur="500px"){const uniqueEntries=new Set;const filteredData={nom:[],date_naiss:[],lieu_naiss:[]};for(let i=0;i<jsonData.nom.length;i++){const nom=jsonData.nom[i];const date=jsonData.date_naiss[i]??"";const lieu=jsonData.lieu_naiss[i]??"";const key=`${nom}|${date}|${lieu}`;if(!uniqueEntries.has(key)){uniqueEntries.add(key);filteredData.nom.push(nom);filteredData.date_naiss.push(date);filteredData.lieu_naiss.push(lieu)}}var mapDiv=document.getElementById("map");mapDiv.style.width=largeur;mapDiv.style.height=hauteur;if(mapDiv._leaflet_id){mapDiv._leaflet_id=null}var osm=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"});const satellite=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles © Esri"});var map=L.map("map",{fullscreenControl:true,layers:[osm]}).setView([46.5,2.5],5);L.control.layers({"Plan OSM":osm,"Satellite Esri":satellite}).addTo(map);const arrGroupTowns={};for(let i=0;i<filteredData.nom.length;i++){const lieu=filteredData.lieu_naiss[i].trim();if(!lieu)continue;if(!arrGroupTowns[lieu])arrGroupTowns[lieu]=[];const nom=filteredData.nom[i];const date=filteredData.date_naiss[i];const ligne=`- ${nom}${date?` (${date.substring(0,4)})`:""}`;arrGroupTowns[lieu].push(ligne)}let premierePosition=null;for(const[lieu,personnes]of Object.entries(arrGroupTowns)){await sleep(1e3);const result=await fctGeocodeNominatim(lieu);if(result){const contenu=`<b>${lieu}</b><br>`+personnes.join("<br>");L.marker([result.lat,result.lon]).addTo(map).bindTooltip(contenu,{direction:"top",sticky:true,className:"bulle"});if(!premierePosition){premierePosition={lat:result.lat,lon:result.lon};map.setView([premierePosition.lat,premierePosition.lon],6)}}}}var images=[];var currentIndex=0;var popupWindow=null;function openPopup(index){currentIndex=index;const imagePath="picture/"+ibase+"/"+images[currentIndex];const screenWidth=window.screen.width;const leftPosition=screenWidth-600;const windowFeatures=`width=600,height=400,top=0,left=${leftPosition},resizable=yes`;if(popupWindow&&!popupWindow.closed){injectContent(imagePath)}else{popupWindow=window.open("","imagePopup",windowFeatures);injectContent(imagePath)}}function injectContent(imagePath){const imageName=imagePath.split("/").pop();popupWindow.document.open();popupWindow.document.write(`\n        <html>\n        <head>\n            <title>Image Popup</title>\n            <style>\n                body {\n                    margin: 0;\n                    overflow: hidden;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    background-color: #000;\n                }\n                img {\n                    max-width: 100%;\n                    max-height: 80%;\n                }\n                .nav-arrow {\n                    position: fixed;\n                    top: 50%;\n                    transform: translateY(-50%);\n                    background-color: rgba(0, 0, 0, 0.5);\n                    color: white;\n                    font-size: 24px;\n                    padding: 10px;\n                    cursor: pointer;\n                    user-select: none;\n                    z-index: 1000;\n                }\n                .nav-arrow.left {\n                    left: 10px;\n                }\n                .nav-arrow.right {\n                    right: 10px;\n                }\n                .image-name {\n                    font-family:  Arial, Helvetica, sans-serif;\n                    color: white;\n                    font-size: 18px;\n                    margin-top: 10px;\n                    text-align: center;\n                    z-index: 1000;\n                }\n            </style>\n        </head>\n        <body>\n            <div class="image-name">${imageName}</div>\n            <span class="nav-arrow left" onclick="window.opener.prevImage()">&#10094;</span>\n            <img src="${imagePath}" alt="Popup Image">\n            <span class="nav-arrow right" onclick="window.opener.nextImage()">&#10095;</span>\n        </body>\n        </html>\n    `);popupWindow.document.close()}function prevImage(){currentIndex=(currentIndex-1+images.length)%images.length;updatePopupImage()}function nextImage(){currentIndex=(currentIndex+1)%images.length;updatePopupImage()}function updatePopupImage(){const newImagePath="picture/"+ibase+"/"+images[currentIndex];injectContent(newImagePath)}window.onbeforeunload=function(){if(popupWindow&&!popupWindow.closed){popupWindow.close()}};function initVariablesTabMain(){enteteCol="[]";fonc="";sortColumn="";sortOrder="";p1="";p2="";p3="";p4="";p5="";p6="";if(PagePhp==="evenement.php"){enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.NomCo+`","`+gotLang.Evene+`","`+gotTag.DATE+`","`+gotLang.Lieux+`","`+gotTag.NOTE+`"]`;fonc="get_events";sortColumn="nom"}if(PagePhp==="listes.php"){if(getPag=="nom")enteteCol=`["","","","","","`+gotLang.Noms+`","Nb","`+gotLang.Lieux+`"]`;if(getPag=="prenom1")enteteCol=`["","","","","","`+gotLang.Preno+`","Nb","`+gotLang.Lieux+`"]`;if(getPag=="lieu_evene")enteteCol=`["","","","","","`+gotLang.Lieux+`","Nb","`+gotLang.Noms+`"]`;if(getPag=="dept_evene")enteteCol=`["","","","","","`+gotLang.Depar+`","Nb","`+gotLang.Noms+`"]`;if(getPag=="country_evene")enteteCol=`["","","","","","`+gotTag.CTRY+`","Nb","`+gotLang.Noms+`"]`;if(getPag=="region_evene")enteteCol=`["","","","","","`+gotLang.Regio+`","Nb","`+gotLang.Noms+`"]`;fonc="recup_eclair"}if(PagePhp==="stat.php"&&getPag==="lon"){displayDiv("DivTitleMain",gotLang.Vecus);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+gotTag.AGE+`"]`;fonc="recup_deces";sortColumn="calcul";sortOrder="DESC";p5="age"}if(PagePhp==="stat.php"&&getPag==="marA"){displayDiv("DivTitleMain",gotLang.StMar+" "+gotLang["+jeun"]);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+gotTag.AGE+`"]`;fonc="recup_maries";sortColumn="calcul";sortOrder="ASC";p5="age"}if(PagePhp==="stat.php"&&getPag==="marD"){displayDiv("DivTitleMain",gotLang.StMar+" "+gotLang.MoiLo);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+gotLang.Duree+`"]`;fonc="recup_noces";sortColumn="calcul";sortOrder="ASC";p5="age"}if(PagePhp==="stat.php"&&getPag==="par"){displayDiv("DivTitleMain",gotLang.StPar+" "+gotLang["+jeun"]);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+gotTag.AGE+`"]`;fonc="recup_parents";sortColumn="calcul";sortOrder="ASC";p5="age"}if(PagePhp==="stat.php"&&getPag==="fam"){displayDiv("DivTitleMain",gotLang.NbEnf);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+"Nb"+`"]`;fonc="recup_parents";sortColumn="calcul";sortOrder="DESC";p5="nb"}if(PagePhp==="stat.php"&&getPag==="jum"){displayDiv("DivTitleMain",gotLang.Jumea);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+"Nb"+`"]`;fonc="recup_jumeaux";sortColumn="nb";sortOrder="DESC";p5="nb"}if(PagePhp==="stat.php"&&(getPag==="nom"||getPag==="prenom1"||getPag==="lieu_evene"||getPag==="dept_evene"||getPag==="region_evene"||getPag==="country_evene")){paramTabMain=`{"fonc":"recup_eclair","sortColumn":"7","sortOrder":"DESC","p1":"","p2":"","p3":"","p4":"","p5":""}`;fonc="recup_eclair";sortColumn="7";sortOrder="DESC"}return{enteteCol:enteteCol,fonc:fonc,sortColumn:sortColumn,sortOrder:sortOrder,p1:p1,p2:p2,p3:p3,p4:p4,p5:p5,p6:p6}}function initVariablesTabMain2(){enteteCol="[]";fonc="";sortColumn="";sortOrder="";p1="";p2="";p3="";p4="";p5="";p6="";if(PagePhp==="stat.php"&&getPag==="marA"){displayDiv("DivTitleMain2",gotLang.StMar+" "+gotLang["+ages"]);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+gotTag.AGE+`"]`;fonc="recup_maries";sortColumn="calcul";sortOrder="DESC";p5="age"}if(PagePhp==="stat.php"&&getPag==="marD"){displayDiv("DivTitleMain2",gotLang.StMar+" "+gotLang.PluLo);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+gotLang.Duree+`"]`;fonc="recup_noces";sortColumn="calcul";sortOrder="DESC";p5="age"}if(PagePhp==="stat.php"&&getPag==="par"){displayDiv("DivTitleMain2",gotLang.StPar+" "+gotLang["+ages"]);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+gotTag.AGE+`"]`;fonc="recup_parents";sortColumn="calcul";sortOrder="DESC";p5="age"}if(PagePhp==="stat.php"&&getPag==="fam"){displayDiv("DivTitleMain2",gotLang.EcaFS);enteteCol=`["","","","","","`+gotTag.NAME+`","`+gotLang.Years+`","`+gotTag.AGE+`"]`;fonc="recup_parents";sortColumn="calcul";sortOrder="DESC";p5="ecart"}return{enteteCol:enteteCol,fonc:fonc,sortColumn:sortColumn,sortOrder:sortOrder,p1:p1,p2:p2,p3:p3,p4:p4,p5:p5,p6:p6}}function initializeSlider(){var paramData=initVariablesTabMain();var paramData2=initVariablesTabMain2();const xhr=new XMLHttpRequest;xhr.open("GET",`get_data.php?start=0&${HrefBase}&fonc=${paramData.fonc}&sortColumn=&sortOrder=&p1=&p2=&p3=1&p4=${paramData.p4}&p5=${paramData.p5}`,true);xhr.onload=function(){if(this.status===200){const data=JSON.parse(this.responseText);var rangeMin=document.getElementById("rangeMin");var rangeMax=document.getElementById("rangeMax");var minLabel=document.getElementById("minYearLabel");var maxLabel=document.getElementById("maxYearLabel");rangeMin.min=data[0].minYear;rangeMin.max=data[0].maxYear;rangeMin.value=data[0].minYear;rangeMax.min=data[0].minYear;rangeMax.max=data[0].maxYear;rangeMax.value=data[0].maxYear;minLabel.textContent=data[0].minYear;maxLabel.textContent=data[0].maxYear;const minPercent=(rangeMin.value-rangeMin.min)/(rangeMin.max-rangeMin.min);const maxPercent=(rangeMax.value-rangeMax.min)/(rangeMax.max-rangeMax.min);minLabel.style.left=`calc(${minPercent*100}% - 35px)`;maxLabel.style.left=`calc(${maxPercent*100}% - 5px)`;if(PagePhp==="stat.php"&&(getPag==="nom"||getPag==="prenom1"||getPag==="lieu_evene"||getPag==="dept_evene"||getPag==="region_evene"||getPag==="country_evene")){let minValue4=rangeMin.value.toString().padStart(4,"0");let maxValue4=rangeMax.value.toString().padStart(4,"0");fctDisplayCanvas(minValue4,maxValue4)}else{pagination("TabMain",paramData.enteteCol,paramData.fonc,paramData.sortColumn,paramData.sortOrder,"","",0,paramData.p4,paramData.p5);if(paramData2.fonc!==""&&PagePhp==="stat.php")pagination("TabMain2",paramData2.enteteCol,paramData2.fonc,paramData2.sortColumn,paramData2.sortOrder,"","",0,paramData2.p4,paramData2.p5)}}else{console.error(this.responseText)}};xhr.onerror=function(){console.error("Erreur lors de la requête Ajax pour obtenir les valeurs min/max")};xhr.send()}function updateSlider(){var rangeMin=document.getElementById("rangeMin");var rangeMax=document.getElementById("rangeMax");var minLabel=document.getElementById("minYearLabel");var maxLabel=document.getElementById("maxYearLabel");if(parseInt(rangeMin.value)>=parseInt(rangeMax.value)){rangeMin.value=rangeMax.value-20}if(parseInt(rangeMax.value)<=parseInt(rangeMin.value)){rangeMax.value=rangeMin.value+40}minLabel.textContent=rangeMin.value;maxLabel.textContent=rangeMax.value;const minPercent=(rangeMin.value-rangeMin.min)/(rangeMin.max-rangeMin.min);const maxPercent=(rangeMax.value-rangeMax.min)/(rangeMax.max-rangeMax.min);minLabel.style.left=`calc(${minPercent*100}% - 35px)`;maxLabel.style.left=`calc(${maxPercent*100}% - 5px)`;if(PagePhp==="stat.php"&&(getPag==="nom"||getPag==="prenom1"||getPag==="lieu_evene"||getPag==="dept_evene"||getPag==="region_evene"||getPag==="country_evene")){let minValue4=rangeMin.value.toString().padStart(4,"0");let maxValue4=rangeMax.value.toString().padStart(4,"0");fctDisplayCanvas(minValue4,maxValue4)}else{paramData=initVariablesTabMain();paramData2=initVariablesTabMain2();pagination("TabMain",paramData.enteteCol,paramData.fonc,paramData.sortColumn,paramData.sortOrder,rangeMin.value,rangeMax.value,0,paramData.p4,paramData.p5);if(paramData2.fonc!==""&&PagePhp==="stat.php")pagination("TabMain2",paramData2.enteteCol,paramData2.fonc,paramData2.sortColumn,paramData2.sortOrder,rangeMin.value,rangeMax.value,0,paramData2.p4,paramData2.p5)}}function displayChart(labelX,dataY){var tempDiv=document.createElement("div");tempDiv.className="ligne_tr2";document.body.appendChild(tempDiv);var backgroundColor=window.getComputedStyle(tempDiv).backgroundColor;document.body.removeChild(tempDiv);sexColor=getSexColor(Sex);new Chart(document.getElementById("statCanvas"),{type:"horizontalBar",data:{labels:labelX,datasets:[{data:dataY,backgroundColor:backgroundColor}]},options:{legend:{display:false},scales:{xAxes:[{position:"top",ticks:{fontSize:16,fontStyle:"bold",fontColor:"black",beginAtZero:true}}],yAxes:[{ticks:{fontSize:16,fontStyle:"bold",fontColor:"black"}}]},plugins:{datalabels:{labels:{title:{color:sexColor,font:{size:16,weight:"bold"}}},formatter:function(value){return value}}}}})}function fctDisplayCanvas(minYear,maxYear){var xhr=new XMLHttpRequest;let url=`get_data.php?start=0&${HrefBase}&fonc=recup_eclair&sort_column=7&sort_order=DESC&p1=${minYear}&p2=${maxYear}&p3=0&p4=`;xhr.open("GET",url,true);xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var data=JSON.parse(xhr.responseText);const reorganizedData=data.reduce(((acc,item)=>{acc.Col1.push(item.Col1);acc.nb.push(item.nb);return acc}),{Col1:[],nb:[]});displayChart(reorganizedData.Col1,reorganizedData.nb)}};xhr.onerror=function(){console.error("Erreur lors de la requête Ajax ")};xhr.send()}function isNoble(name){const prefixes=["DE ","DU ","D'","VON ","OF "];if(ibase==="royal_small")return prefixes.some((prefix=>name.includes(prefix)));else return prefixes.some((prefix=>name.startsWith(prefix)))}function nobleChildren(id_indi,data,generation=0){let childrenWithTitle=false;let children=[];for(let i=0;i<data.id_pere.length;i++){if(data.id_pere[i]===id_indi||data.id_mere[i]===id_indi){children.push(data.id_indi[i])}}if(children.length!==0){for(let enfant of children){let nameEnfant=data.nom[data.id_indi.indexOf(enfant)];if(isNoble(nameEnfant)){childrenWithTitle=true}else{if(nobleChildren(enfant,data,generation+1)){childrenWithTitle=true}}}}return childrenWithTitle}function findRootsNobles(data){let roots=[];for(let i=0;i<data.id_indi.length;i++){let name=data.nom[i];let id_indi=data.id_indi[i];let date_naiss=data.date_naiss[i];let lieu_naiss=data.lieu_naiss[i];let sexe=data.sexe[i];if(isNoble(name)){if(!nobleChildren(id_indi,data)){roots.push({id_indi:id_indi,nom:name,date_naiss:date_naiss,lieu_naiss:lieu_naiss,sexe:sexe})}}}return roots}